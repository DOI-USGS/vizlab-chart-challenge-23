---
title: "28 Trends - How much Water is entering Lake Tahoe?"
author: "Margaux Sleckman"
date: "2023-03-10"
output: html_document
---

```{r setup, include=FALSE, warning=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE)
source('src/funs.R')

```

```{r libraries,include=FALSE, warning=FALSE, message=FALSE}
# Load libraries
library(tidyverse) # includes ggplot
library(readr) # best for reading and writing csvs
library(lubridate)
library(glue)
library(zoo)
library(sf)
library(mapdata)
library(maps)
library(purrr)
library(spData)
library(ggspatial)
library(ggrepel)
library(colorfindr)
library(gghighlight)
library(scales)
library(nhdplusTools)
library(dataRetrieval)

# These are used for the layout of the viz
library(cowplot) # for laying out the final plot
library(sysfonts) # for text editing
library(showtext) # for adding in google fonts
library(magick) # for adding logo
library(mapview) # for interactive map viz

```

```{r options_dir_creation, include=FALSE, warning=FALSE, message=FALSE}

options(tidyverse.quiet = TRUE, timeout = 500)
mapviewOptions(fgb = FALSE)

## Creating local folders for add
dir.create('in/R', showWarnings = F)
dir.create('in/R/nhdPlusTools', showWarnings = F)

```


## A. Workflow for Map 
### 1. Fetching nhdplus spatial data w/ nhdplustools
_code hidden_
```{r generic_nhdPlus_data_fetch, include=FALSE, warning=FALSE, message=FALSE}

# state boundaries --------------------------------------------------------

CA_sf <- us_states |> filter(NAME == 'California')

West_sf <- us_states |> filter(NAME %in% c('California','Oregon',
                                           'Nevada','Utah',
                                           'Arizona',
                                           'Idaho','Washington'))

# AOI for NHD data extraction ---------------------------------------------

## grab huc 8s with nhdplus tools
CA_huc8 <- nhdplusTools::get_huc8(AOI = CA_sf) 

LT_huc8 <- CA_huc8|> 
  filter(name == 'Lake Tahoe')

## define all huc4 to allow data download
LT_huc4 <- LT_huc8$huc8 |> substr(1,4) |> unique()

# NHD Data Download (conditional Run only if not downloaded yet) ----------------------------------

if(length(list.files('in/R/nhdPlusTools')) == 0){
  
  print(paste('Downloading NHD data for the following selected CA HUC4s', LT_huc4))

  download_nhdplushr('in/R/nhdPlusTools', LT_huc4)
}

huc_gpkg_path <- 'in/R/nhdPlusTools/nhdplustools_HU_data.gpkg'
wtbdy_gpkg_path <- 'in/R/nhdPlusTools/nhdplustools_wtrbdy_data.gpkg'

if(length(list.files('in/R/nhdPlusTools', full.names = T, pattern = '_data.gpkg')) == 0){

  # Store HUCs shps into geopackage
  print(paste('... Storing HUCs shps into a local geopackage here:', huc_gpkg_path))
  nhdplusTools::get_nhdplushr(hr_dir = 'in/R/nhdPlusTools/',
                              out_gpkg = huc_gpkg_path,
                              layer = c('WBDHU6','WBDHU8', 'WBDHU10'))

  # Store Waterbodies shps into geopackage
  print(paste('... Storing Waterbody shps into a local geopackage here:', wtbdy_gpkg_path))
  nhdplusTools::get_nhdplushr(hr_dir = 'in/R/nhdPlusTools/',
                              out_gpkg = wtbdy_gpkg_path,
                              layer = 'NHDWaterbody')

  # # Store Waterbodies shps into geopackage
  # # This one takes A-WHILE so defaulted to using nhdplustools::get_flines()
  # nhdplusTools::get_nhdplushr(hr_dir = 'in/R/nhdPlusTools/',
  #                            out_gpkg = 'in/R/nhdplustools_flines_data.gpkg',
  #                            layer = 'NHDFlowline')

  }
  
## Display Layers
print(st_layers(huc_gpkg_path))
print(st_layers(wtbdy_gpkg_path))

# Load nhdPlus features for AOI ----------------------------------------------------------------
## HUCS
huc10 <- st_read(huc_gpkg_path, layer = 'WBDHU10')
huc8 <- st_read(huc_gpkg_path, layer = 'WBDHU8') 
huc6 <- st_read(huc_gpkg_path, layer = 'WBDHU6')

## Waterbodies
lakes <- st_read(wtbdy_gpkg_path, layer = 'NHDWaterbody') |> 
  st_make_valid()

lakes_in_hucs <- st_join(lakes, huc6) |>
  ## filtering out NA HUC6 because this ensures that we only have Lakes within the CA Huc6 boundaries
  filter(!is.na(HUC6),
  ## rm-ing NA AreaSqKM
  !is.na(AreaSqKM.x))

```

### 2. Fetch geospatial data for Lake Tahoe Basin
_code hidden_
```{r LT_data_pull, include=FALSE, warning=FALSE, message=FALSE}

# NHDPLUS Tools data - Lake Tahoe subset ----------------------------------

# HUC
Lake_Tahoe_huc6 <- filter(huc6, Name == 'Truckee') 
Lake_Tahoe_huc8 <- filter(huc8, Name == 'Lake Tahoe')

# Water features
LT_lakes <- st_join(lakes_in_hucs , Lake_Tahoe_huc8) |>
  filter(!is.na(HUC8))

## grabbing just LT
LT <- LT_lakes |> filter(GNIS_Name == "Lake Tahoe")

LT_flines <- get_nhdplus(AOI = Lake_Tahoe_huc8,
                         realization = 'flowline',
                         streamorder = 1)

# NWIS Gages --------------------------------------------------------------

# ID Active NWIS Sites in LT Basin

## ID active sites from last 90 days (dv)
prev90days <- Sys.Date() - 90
active_sites_data_2023 <- readNWISdata(huc = Lake_Tahoe_huc8$HUC8,
                                       service = "dv",
                                       parameterCd = "00060",
                                       startDate = prev90days) |> 
  filter(site_no != "103366092")

## Vector of currently active sites
active_sites_2023 <- unique(active_sites_data_2023$site_no)

site_lst_ordered <- c("10336676",
                      "10336660",
                      "10336645",
                      "10336610",
                      # "103366092",  ## removing this site because too far away from lake
                      "10336780",
                      "10336730",
                      "10336715",
                      "10336700",
                      "10336698")

active_sites_2023 <- factor(active_sites_2023, site_lst_ordered) |> sort()

active_nwis_sites_lake_tahoe <- get_nwis(AOI = Lake_Tahoe_huc8,
                                         t_srs = NULL,
                                         buffer = 0) |>
  filter(site_no %in% active_sites_2023) |> 
  mutate(site_no = factor(site_no, active_sites_2023)) |> arrange(site_no)

```

#### Obs. LT spatial data in mapview
_code hidden_
```{r looking_at_spatial_data_w_mapview, echo = FALSE,  warning=FALSE, message=FALSE}

# Quick Mapview -----------------------------------------------------------

## VIZ
mapview(LT_flines, color = 'darkblue')+
  mapview(LT_lakes, col.regions = 'darkblue')+
  mapview(active_nwis_sites_lake_tahoe, col.regions = 'red')+
  mapview(Lake_Tahoe_huc8, col.regions = NA, color = 'black', alpha.regions = 0)

```


### 3. Map Plotting
```{r LT_map, warning=FALSE, message=FALSE}

# Viz Variables -----------------------------------------------------------

map_bbox <- st_bbox(Lake_Tahoe_huc8)

lt_all_colors <- c("#000000", "#0046A5", "#005DBA", "#0082CD", "#001E54","#00427C",
                "#FFFEFF", "#3DA6DD", "#574435", "#C7BBAD", "#4492DA", "#0079BE",
                "#005E94", "#95C2E1", "#B0CFE3", "#171310", "#354658", "#97D4AB",
                "#6B5E56", "#647100", "#A8D0F4", "#007FD0", "#63AEEF", "#00599F",
                "#00B79F", "#00B3A0", "#00506B", "#001920", "#2EE5C6", "#889756"
                )

show_col(lt_all_colors)

```

```{r main_map}
# Main map -----------------------------------------------------------

lt_map <- ggplot()+
  ## State boundaries
   geom_sf(data = CA_sf,
           fill = 'white',
           color = 'grey',
           alpha = 0.1,
           size = 0.5)+
  ## lakes (incl. all lakes in basin)
   geom_sf(data = LT,
           fill = "#A8D0F4", 
           color = "#A8D0F4",
           alpha = 0.8)+
  ## huc8 boundary of basin
   # geom_sf(data = Lake_Tahoe_huc8,
   #         fill = 'transparent',
   #         color = 'firebrick',
   #         size = 0.8,
   #         linetype = 'dotted')+
  ## Basin flowlines
   geom_sf(data = LT_flines,
           color = "#A8D0F4",
           size  = 0.5,
           alpha = 0.7)+
  ## nwis st stations around LT
   geom_sf(data = active_nwis_sites_lake_tahoe |>
             ## removing sites that are too close together
             filter(!site_no %in% c('10336698','10336700')),
           color = "#97D4AB",
           fill = "#00B79F",
           size = 3, 
           shape = 21)+
    ## nwis st stations around LT
   geom_sf(data = active_nwis_sites_lake_tahoe |>
             filter(site_no %in% c('10336698',
                                   '10336700')) |> 
             st_jitter(amount = 0.005),
           color = "#97D4AB",
           fill = "#00B79F",
           size = 3,
           shape = 21)+
  # ## station labels
  #  geom_text_repel(data = active_nwis_sites_lake_tahoe,
  #                 color = 'black',
  #               aes(label = site_no,
  #                   geometry = geometry),
  #               stat = "sf_coordinates",
  #   min.segment.length = 1,
  #   size =3,
  #   nudge_x = 0.05,
  #   point.padding = 1e-04)+
   coord_sf(
     ylim = c(map_bbox$ymin, map_bbox$ymax),
     xlim = c(map_bbox$xmin, map_bbox$xmax)
     )+
   theme_classic()+
  ## adding state labels at top of map
  annotate('text', x = -120.10, y = 39.34, label = c('California'),
           hjust = 'left', size = 3, fontface = 'italic',  colour = 'grey')+
  annotate('text', x = -119.95, y = 39.34, label = c('Nevada'),
           hjust = 'left', size = 3, fontface = 'italic', colour = 'grey')

```

```{r extent_map}
extent_bbox <- st_bbox(Lake_Tahoe_huc8)
extent_lt_huc8 <- st_as_sfc(extent_bbox)

extent_map <- ggplot() + 
    geom_sf(data = West_sf, fill = "white", color = alpha('grey', 0.5)) + 
    geom_sf(data = extent_lt_huc8, color = 'forest green', fill = NA) +
    geom_sf(data = LT, fill = "#A8D0F4", color = "#A8D0F4", alpha = 0.8)+
   coord_sf(
     ylim = c(extent_bbox$ymin - 5.5, extent_bbox$ymax + 5.5),
     xlim = c(extent_bbox$xmin - 5.5, extent_bbox$xmax + 5.5)
     )+
  theme_void()

extent_map

```

```{r segments}

  lt_map_segs <- lt_map + 
    # top left
    geom_segment(aes(x = active_nwis_sites_lake_tahoe$geometry[[1]][1] - 0.015, xend = active_nwis_sites_lake_tahoe$geometry[[1]][1] - 0.1, 
                     y = active_nwis_sites_lake_tahoe$geometry[[1]][2] + 0.005, yend = active_nwis_sites_lake_tahoe$geometry[[1]][2] + 0.06),
                 arrow = arrow(length = unit(0.03, "npc")),
                 arrow.fill = "#354658", alpha = 0.4)+
    # 2nd to top left
      geom_segment(aes(x = active_nwis_sites_lake_tahoe$geometry[[2]][1] - 0.015, xend = active_nwis_sites_lake_tahoe$geometry[[2]][1] - 0.1, 
                     y = active_nwis_sites_lake_tahoe$geometry[[2]][2], yend = active_nwis_sites_lake_tahoe$geometry[[2]][2] - 0.03), 
                 arrow = arrow(length = unit(0.03, "npc")),
                 arrow.fill = "#354658", alpha = 0.4)+
    # 2nd to bottom left 
      geom_segment(aes(x = active_nwis_sites_lake_tahoe$geometry[[3]][1] - 0.015, xend = active_nwis_sites_lake_tahoe$geometry[[3]][1] - 0.15, 
                     y = active_nwis_sites_lake_tahoe$geometry[[3]][2] - 0.003, yend = active_nwis_sites_lake_tahoe$geometry[[3]][2] - 0.08), 
                 arrow = arrow(length = unit(0.03, "npc")),
                 arrow.fill = "#354658", alpha = 0.4)+
    # bottom left
      geom_segment(aes(x = active_nwis_sites_lake_tahoe$geometry[[4]][1]-0.015, xend = active_nwis_sites_lake_tahoe$geometry[[4]][1] - 0.13, 
                     y = active_nwis_sites_lake_tahoe$geometry[[4]][2]- 0.006, yend = active_nwis_sites_lake_tahoe$geometry[[4]][2] - 0.07 ), 
                 arrow = arrow(length = unit(0.03, "npc")),
                 arrow.fill = "#354658", alpha = 0.4)+
    # bottom right
     geom_segment(aes(x = active_nwis_sites_lake_tahoe$geometry[[5]][1] + 0.015, xend = active_nwis_sites_lake_tahoe$geometry[[5]][1] + 0.11, 
                     y = active_nwis_sites_lake_tahoe$geometry[[5]][2] - 0.01, yend = active_nwis_sites_lake_tahoe$geometry[[5]][2] - 0.1), 
                 arrow = arrow(length = unit(0.03, "npc")),
                 arrow.fill = "#354658", alpha = 0.4)+
    # 2nd to bottom on right
      geom_segment(aes(x = active_nwis_sites_lake_tahoe$geometry[[6]][1] + 0.015, xend = active_nwis_sites_lake_tahoe$geometry[[6]][1] + 0.07, 
                     y = active_nwis_sites_lake_tahoe$geometry[[6]][2] - 0.01, yend = active_nwis_sites_lake_tahoe$geometry[[6]][2] - 0.08), 
                 arrow = arrow(length = unit(0.03, "npc")),
                 arrow.fill = "#354658", alpha = 0.4)+
    # 3rd to top on right
      geom_segment(aes(x = active_nwis_sites_lake_tahoe$geometry[[7]][1] + 0.015, xend = active_nwis_sites_lake_tahoe$geometry[[7]][1] + 0.04, 
                     y = active_nwis_sites_lake_tahoe$geometry[[7]][2] - 0.01, yend = active_nwis_sites_lake_tahoe$geometry[[7]][2] - 0.04), 
                 arrow = arrow(length = unit(0.03, "npc")),
                 arrow.fill = "#354658", alpha = 0.4)+
    # top-right-right
      geom_segment(aes(x = active_nwis_sites_lake_tahoe$geometry[[8]][1] + 0.015, xend = active_nwis_sites_lake_tahoe$geometry[[8]][1] + 0.085, 
                     y = active_nwis_sites_lake_tahoe$geometry[[8]][2] - 0.005, yend = active_nwis_sites_lake_tahoe$geometry[[8]][2] - 0.02), 
                 arrow = arrow(length = unit(0.03, "npc")),
                 arrow.fill = "#354658", alpha = 0.4)+
    ## top-right
      geom_segment(aes(x = active_nwis_sites_lake_tahoe$geometry[[9]][1] + 0.01, xend = active_nwis_sites_lake_tahoe$geometry[[9]][1] + 0.08, 
                       y = active_nwis_sites_lake_tahoe$geometry[[9]][2] + 0.01, yend = active_nwis_sites_lake_tahoe$geometry[[9]][2] + 0.08), 
                   arrow = arrow(length = unit(0.03, "npc")),
                   arrow.fill = "#354658", alpha = 0.4)
  

## using generic save_map function to generate final map (in 'src/funs.R')
lt_map_for_viz <- final_map_formatting(lt_map_segs,
                                       scale_arrow_color = "#00427C",
                                       out_file = 'out/LT_map_gauges.png')

```

## B. Workflow for lineplots

### 1. Extract and Process Gauge Data for plots
_code hidden_
```{r pull_nwis_data, include= FALSE, warning= FALSE, message=FALSE}

# Pull all NWIS data for active sites

## check the site history
view_data_summary <- readNWISstat(siteNumbers = as.character(active_sites_2023),
                                  parameterCd="00060",
                                  statReportType="annual",
                                  statType="mean") |>
  group_by(site_no,year_nu) |>
  summarize(n()) |>
  arrange(year_nu)

# What sort of data is avail at sites
dailyDataAvailable <- whatNWISdata(
  siteNumber = active_sites_2023,
  service = 'dv') |>
  select(site_no, station_nm, data_type_cd, parm_cd, begin_date, end_date)

## Get Data with readNWISdv 
LT_dv_data <- readNWISdv(siteNumbers = active_sites_2023,
           parameterCd = '00060') |> 
  renameNWISColumns()

## IV data ? 
# readNWISdata(site_no = active_sites_2023, service = 'iv')

```

### 2. Process flow data
_code hidden_
```{r flow_data_processing, include= FALSE, warning= FALSE, message=FALSE}

# Dates --------------------------------------------------------------

LT_dv_data_dates <- LT_dv_data |>
  ## keeping year numeric to enable filter
  mutate(year = year(Date),
         month = month(Date, label = T),
         day = day(Date),
         day_of_week = lubridate::wday(Date, label = T),
         ## grabing month_day only, as I hope this can be the X axis - however this is not considered Date format. 
         month_day = format(Date,"%m-%d"),
         fake_date = as.Date(paste0('2020-',month_day))
         )

# Moving Avg ----------------------------------------------------------

# Calc Moving average Values into a new column
LT_dv_data_w_MA <- LT_dv_data_dates |>
  ## calc MA with zoo::rollmean() . Check what k (2nd param) is for 
  mutate(MA = rollmean(x = Flow, 
                       k = 5,
                       na.pad = T,
                       align = 'center'))

# Focus on Spring flow ----------------------------------------------------

LT_dv_data_viz <- LT_dv_data_w_MA |> 
  ## all sites have data up until april 15 (one does have data passed that)
#  filter(Date < 2023-04-15) |> 
  filter(month %in% c('Mar','Apr','May'),
         fake_date >= '2020-03-01',
         fake_date <= '2020-05-15'
#         year %in% c(2020,2021,2022,2023),
#        day_of_week %in% c('Mon','Wed','Fri')
         ) |>
  ## reorder counter clock wise for plot
  mutate(site_no = factor(site_no, active_sites_2023)) |> 
  arrange(site_no) |> 
  group_by(site_no) 
  

### Temp code to run plit quickly and ###
# # ## Generate plot
LT_dv_data_viz |>
  filter(
  # year %in% c(2018, 2019,2020),
  # year %in% c(2018,2019,2020, 2021, 2022, 2023),
  site_no %in% c(
                 '10336698'
                 # '10336700'
                 )) |>
  ggplot()+
  geom_line(aes(x = fake_date, y = Flow, color = site_no))+
  # geom_line(aes(x = fake_date, y = MA, color = site_no), linetype = 'dotted')+
  theme_minimal()
  # gghighlight(max(MA), max_highlight = 3L)+
  # facet_wrap(vars(site_no), scales = 'free')

```

### 3. Generate Lineplots
```{r flow_data_line_plot, warning=FALSE, message=FALSE, results = 'hide'}

## generate line plots
## Note - function pulled from 'src/funs.R'
line_plot_lst <- LT_dv_data_viz |>
  group_map( ~time_series_plot(data = .x,
                               x_var = 'fake_date', ## note - created a fake date with same year to get each year as different line
                               y_var = 'MA',
                               date_range =  c('1975-01-01', '2023-05-15'),
                               string_format_title = 'USGS Station ID: %s',
                               top_year_num = 4,
                               out_folder = 'out',
                               color_palette = "#66C2A4"
                               ),
             .keep = TRUE) ## note - setting keep = TRUE ensure group col is kept.

line_plot_grid_1 <- cowplot::plot_grid(plotlist = line_plot_lst[1:5])
line_plot_grid_2 <-cowplot::plot_grid(plotlist = line_plot_lst[6:10])

ggsave(plot = line_plot_grid_1, filename = 'out/line_plot_grid_1.png',
       width = 9, height = 9, dpi = 300)
ggsave(plot = line_plot_grid_2, filename = 'out/line_plot_grid_2.png',
       width = 9, height = 9, dpi = 300)

```

### Final Viz Pieces

1. lt_map_for_viz
2. line_plot_lst

```{r plots, warning = FALSE, message = FALSE}

lt_map_for_viz
line_plot_grid_1
line_plot_grid_2

```



## Formatting

```{r plotting_vars}

# Load some custom fonts and set some custom settings
font_legend <- "Vollkorn"
sysfonts::font_add_google("Vollkorn")
supporting_font <- "Source Sans Pro"
sysfonts::font_add_google("Source Sans Pro")
showtext::showtext_opts(dpi = 300, regular.wt = 200, bold.wt = 700)
showtext::showtext_auto(enable = TRUE)

# Define colors
background_color = "#FFFEFF"
font_color = "#0046A5"

# The background canvas for your viz
canvas <- grid::rectGrob(
  x = 0, y = 0, 
  width = 16, height = 9,
  gp = grid::gpar(fill = background_color, alpha = 1, col = background_color)
)

# Load in USGS logo (also a black logo available)
usgs_logo <- magick::image_read("../usgs_logo_black.png") 


```

Arrange line plots 

```{r cowplotting_line_plots}

Ymargin <- 0.04
Xmargin <- 0.04
Xbase <- 1-Xmargin # from right
Ybase <- Ymargin*2 # from bottom
Yjitter <- (0.40 - 2*Ymargin)/2
Xjitter <- (1 - 2*Xmargin)/5 # total jitter
Xwidth <- 0.15


## Note - purrr must be placed ahead of map otherwise the loop won't work (`coerce of type `closure` error`)
draw_line_plots <- purrr::map(1:length(line_plot_lst), function(x){
  
                          if(x == 1){
                          X_position <- 0.4
                          Y_position <- 0.65
                        } else if(x == 2){
                          X_position <- 0.36
                          Y_position <- 0.48  
                        } else if(x == 3){
                          X_position <- 0.4
                          Y_position <- 0.30
                        } else if(x == 4){
                          X_position <- 0.49
                          Y_position <- 0.11  
                        } else if(x == 5){
                          X_position <- 0.80
                          Y_position <- 0.1  
                        } else if(x == 6){
                          X_position <- 0.84
                          Y_position <- 0.27   
                        } else if(x == 7){
                          X_position <- 0.84
                          Y_position <- 0.45
                        } else if(x == 8){
                          X_position <- 0.84
                          Y_position <- 0.62
                        } else if(x == 9){
                          X_position <- 0.8
                          Y_position <- 0.8
                        } else { 
                          X_position <- 0.35
                          Y_position <- 0.08
                          }
  
                       draw_plot(line_plot_lst[[x]],
                                 x = X_position,
                                 y = Y_position,
                                 hjust = 1,
                                 height = Yjitter,
                                 width = Xjitter
                                 ) 

})

```


## C. Produce final plot

```{r cowplot, fig.width = 16, fig.height = 9, warning=FALSE, message=FALSE}

ggdraw(ylim = c(0,1), # 0-1 scale makes it easy to place viz items on canvas
       xlim = c(0,1)) +
  # a background
  draw_grob(canvas,
            x = 0, y = 1,
            height = 9, width = 16,
            hjust = 0, vjust = 1) +
  # the main plot
  draw_plot(extent_map,
            x = 0.001,
            y = 0.08,
            height = 0.4,
            width = 0.2
            # hjust = 1
            # # height = 1,
            # width = 1,
            # scale = 1
            )+
  draw_plot(lt_map_for_viz,
            x = 0.01,
            y = 0.01,
            height = 1,
            width = 1,
            scale = 0.8) +
  draw_line_plots +
  # explainer text
  draw_label("Following an unprecedented Winter, the snowpack of the California Sierra Nevada mountain range is generating\nsignificant water flow through it's rivers and lakes. This data visualization shows daily streamflow measurements at USGS stream gauges\nsurrounding Lake Tahoe for the months of March to May in 2023, as well as all historical years dating back to 1975 (in grey).",
             fontfamily = supporting_font,
             x = 0.35,   
             y = 0.05,
             size = 12,
             hjust = 0,
             vjust = 0,
             color = font_color,
            
             )+
  # Title
  draw_label("The Big Melt has begun.\nTrend of Spring Snowmelt Runoff\ninto Lake Tahoe in 2023\ncompared to historical record.",
             x = 0.04,
             y = 0.985,
             hjust = 0,
             vjust = 1,
             lineheight = 0.75,
             fontfamily = supporting_font,
             color = font_color,
             size = 30) +
  # Add logo
  draw_image(usgs_logo, 
             x = 0.04,
             y = 0.05,
             width = 0.1, 
             hjust = 0, vjust = 0, 
             halign = 0, valign = 0)

# Save the final image in Twitter's 16 by 9 format
# !! Use format for saving with the date of your prompt: 
#         YYYYMMDD_prompt_name ()
# e.g. `20230101_part-to-whole-cnell.png`
ggsave(filename = "out/20230428_trends_msleckman.png", 
       width = 16, height = 9, dpi = 300)
```

## Supporting information

### Key takeaways of this viz (1-2 sentences each)
Following an unprecedented Winter, the snowpack of the California Sierra Nevada mountain rain is generating\nsignificant water flow through rivers and lakes. This data visualization shows daily streamflow measurements at USGS stream gauges surrounding Lake Tahoe\nfor the months of March to May in 2023, as well as all historical years dating back to 1975 (in grey).

1. Key takeaways here
* While it is still early in the Spring season, the 2023 snowmelt runoff in the Lake Tahoe basin is trending upwards across all stream gauges, aiming to surpass previous years dating back to 1975. 
* All gauges are found in tributaries that are uniquely influenced by environmental factors that drive snow melt such as temperature or topography. This explains the variability in flow across each gauges. 

### Data source(s)

NHDPlus High Resolution - geospatial dataset capturing water basins and flow of water across the Nation's landscapes. https://www.usgs.gov/national-hydrography/nhdplus-high-resolution

USGS National Water Information System - water data collected at water gauges.
https://waterdata.usgs.gov/nwis/rt


